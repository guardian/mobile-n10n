stacks: [mobile-notifications]
regions: [eu-west-1]
deployments:
  registration-cfn:
    type: cloud-formation
    app: registration
    dependencies: [ registrations-db-cfn ]
    parameters:
      amiParametersToTags:
        # AMI from YAML stack
        AMI:
          Recipe: mobile-java11-jammy-ARM-with-cdk-base
          AmigoStage: PROD
          Encrypted: 'true'
        # AMI from GuCDK stack
        AMIRegistration:
          Recipe: mobile-java11-jammy-ARM-with-cdk-base
          AmigoStage: PROD
          Encrypted: 'true'
      templateStagePaths:
        CODE: Registration-CODE.template.json
        PROD: Registration-PROD.template.json
      templateStageParameters:
        CODE:
          LegacyLoggingStreamName: /account/services/logging.stream.name.code
          DatabaseAccessSecurityGroup: /CODE/mobile-notifications/registrations-db/postgres-access-security-group
        PROD:
          LegacyLoggingStreamName: /account/services/logging.stream.name
          DatabaseAccessSecurityGroup: /PROD/mobile-notifications/registrations-db/postgres-access-security-group
  registration:
    type: autoscaling
    parameters:
      asgMigrationInProgress: true
      bucketSsmLookup: true
      bucketSsmKey: /account/services/artifact.bucket.n10n
    dependencies: [registration-cfn]
  registrations-db-cfn:
    type: cloud-formation
    app: registrations-db
    parameters:
      templatePath: registration-db.yaml
      cloudFormationStackByTags: true


