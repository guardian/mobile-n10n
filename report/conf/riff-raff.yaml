stacks: [mobile-notifications]
regions: [eu-west-1]
deployments:
  report-cfn:
    type: cloud-formation
    app: report
    parameters:
      amiEncrypted: true
      amiParametersToTags:
        AMIReport:
          Recipe: mobile-java11-jammy-ARM
          AmigoStage: PROD
      templateStagePaths:
        CODE: Report-CODE.template.json
        PROD: Report-PROD.template.json
  report:
    type: autoscaling
    parameters:
      bucketSsmLookup: true
      bucketSsmKey: /account/services/artifact.bucket.n10n
    dependencies: [report-cfn]
  reportextractor:
    type: aws-lambda
    app: reportextractor
    parameters:
      bucketSsmLookup: true
      bucketSsmKey: /account/services/artifact.bucket.n10n
      functionNames: [mobile-notifications-reportextractor-] # TODO switch to tag based lookup once the legacy YAML lambda has been deleted
      fileName: reportextractor.jar
      prefixStack: false
    dependencies: [report-cfn]

  legacy-reportextractor:
    type: aws-lambda
    app: reportextractor
    parameters:
      bucketSsmLookup: true
      bucketSsmKey: /account/services/artifact.bucket.n10n
      functionNames: [legacy-mobile-notifications-reportextractor-]
      fileName: reportextractor.jar
      prefixStack: false
    dependencies: [legacy-reportextractor-cfn]

  legacy-reportextractor-cfn:
    type: cloud-formation
    app: reportextractor
    parameters:
      prependStackToCloudFormationStackName: true
      cloudFormationStackName: reportextractor
      templatePath: cfn.yaml

  eventconsumer:
    type: aws-lambda
    parameters:
      bucketSsmLookup: true
      bucketSsmKey: /account/services/artifact.bucket.n10n
      functionNames:
        - mobile-notifications-eventconsumer-athena-
      fileName: eventconsumer.jar
      prefixStack: false
    dependencies: [eventconsumer-cfn]
  eventconsumer-cfn:
    type: cloud-formation
    app: eventconsumer
    parameters:
      prependStackToCloudFormationStackName: false
      cloudFormationStackName: eventconsumer
      templatePath: cfn.yaml